### Merchant Lifecycle Management API Examples
### Use with REST Client extension in VS Code or similar tools

@baseUrl = http://localhost:3000
@adminToken = your_admin_jwt_token_here
@superAdminToken = your_super_admin_jwt_token_here
@merchantId = merchant_uuid_here
@flagId = flag_uuid_here

###############################################################################
# 1. SUSPEND MERCHANT
###############################################################################

### Suspend merchant with auto-unsuspend (24 hours)
POST {{baseUrl}}/api/v1/merchants/{{merchantId}}/suspend
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "reason": "FRAUD_INVESTIGATION",
  "note": "Multiple suspicious transactions detected requiring immediate investigation and review",
  "durationHours": 24
}

### Suspend merchant indefinitely (no auto-unsuspend)
POST {{baseUrl}}/api/v1/merchants/{{merchantId}}/suspend
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "reason": "AML_REVIEW",
  "note": "Account flagged for AML compliance review. Manual unsuspension required after review completion."
}

### Suspend for policy violation
POST {{baseUrl}}/api/v1/merchants/{{merchantId}}/suspend
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "reason": "POLICY_VIOLATION",
  "note": "Terms of service violation detected. Account suspended pending investigation.",
  "durationHours": 72
}

###############################################################################
# 2. UNSUSPEND MERCHANT
###############################################################################

### Unsuspend merchant after review
POST {{baseUrl}}/api/v1/merchants/{{merchantId}}/unsuspend
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "note": "Investigation completed. No violations found. Account reactivated."
}

### Unsuspend after compliance review
POST {{baseUrl}}/api/v1/merchants/{{merchantId}}/unsuspend
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "note": "AML review completed successfully. All documentation verified and approved."
}

###############################################################################
# 3. TERMINATE MERCHANT (SUPER_ADMIN ONLY)
###############################################################################

### Terminate for confirmed fraud
POST {{baseUrl}}/api/v1/merchants/{{merchantId}}/terminate
Authorization: Bearer {{superAdminToken}}
Content-Type: application/json

{
  "reason": "FRAUD_CONFIRMED",
  "note": "Confirmed fraudulent activity with multiple chargebacks and customer complaints. Account permanently closed per terms of service section 8.3. Final settlement will be processed for legitimate transactions.",
  "confirmed": true
}

### Terminate for AML violation
POST {{baseUrl}}/api/v1/merchants/{{merchantId}}/terminate
Authorization: Bearer {{superAdminToken}}
Content-Type: application/json

{
  "reason": "AML_VIOLATION",
  "note": "Serious AML compliance violations detected. Multiple red flags including suspicious transaction patterns and failure to provide required documentation. Account terminated per regulatory requirements and internal compliance policies.",
  "confirmed": true
}

### Terminate at merchant request
POST {{baseUrl}}/api/v1/merchants/{{merchantId}}/terminate
Authorization: Bearer {{superAdminToken}}
Content-Type: application/json

{
  "reason": "MERCHANT_REQUEST",
  "note": "Merchant requested account closure via support ticket #12345. All outstanding transactions will be settled. Account closed per merchant request on 2026-02-20. No violations or issues.",
  "confirmed": true
}

### Terminate for repeated policy violations
POST {{baseUrl}}/api/v1/merchants/{{merchantId}}/terminate
Authorization: Bearer {{superAdminToken}}
Content-Type: application/json

{
  "reason": "REPEATED_POLICY_VIOLATIONS",
  "note": "Multiple policy violations over 6-month period despite warnings. Violations include: unauthorized product categories, excessive chargebacks, and failure to respond to compliance requests. Account terminated per escalation policy.",
  "confirmed": true
}

### Test termination without confirmation (should fail with 400)
POST {{baseUrl}}/api/v1/merchants/{{merchantId}}/terminate
Authorization: Bearer {{superAdminToken}}
Content-Type: application/json

{
  "reason": "FRAUD_CONFIRMED",
  "note": "This should fail because confirmed is not set to true. Testing validation.",
  "confirmed": false
}

###############################################################################
# 4. COMPLIANCE FLAGS
###############################################################################

### Add AML alert flag
POST {{baseUrl}}/api/v1/merchants/{{merchantId}}/flags
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "type": "AML_ALERT",
  "severity": "HIGH",
  "description": "Multiple transactions flagged by AML monitoring system. Requires immediate review and documentation.",
  "expiresAt": "2026-03-20T00:00:00Z"
}

### Add fraud suspected flag
POST {{baseUrl}}/api/v1/merchants/{{merchantId}}/flags
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "type": "FRAUD_SUSPECTED",
  "severity": "CRITICAL",
  "description": "Suspicious transaction patterns detected. Multiple high-value transactions to high-risk jurisdictions."
}

### Add chargeback ratio flag
POST {{baseUrl}}/api/v1/merchants/{{merchantId}}/flags
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "type": "CHARGEBACK_RATIO_HIGH",
  "severity": "MEDIUM",
  "description": "Chargeback ratio exceeded 2% threshold. Currently at 2.5% over last 30 days. Monitoring required."
}

### Add PEP match flag
POST {{baseUrl}}/api/v1/merchants/{{merchantId}}/flags
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "type": "PEP_MATCH",
  "severity": "HIGH",
  "description": "Merchant owner matched against PEP database. Enhanced due diligence required per compliance policy."
}

### Add sanctions match flag
POST {{baseUrl}}/api/v1/merchants/{{merchantId}}/flags
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "type": "SANCTIONS_MATCH",
  "severity": "CRITICAL",
  "description": "Merchant or beneficial owner matched against sanctions list. Immediate action required per regulatory requirements."
}

### Add prohibited goods flag
POST {{baseUrl}}/api/v1/merchants/{{merchantId}}/flags
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "type": "PROHIBITED_GOODS",
  "severity": "HIGH",
  "description": "Merchant selling prohibited goods not disclosed during onboarding. Immediate review and potential suspension required."
}

###############################################################################
# 5. GET FLAGS
###############################################################################

### Get all flags for merchant
GET {{baseUrl}}/api/v1/merchants/{{merchantId}}/flags
Authorization: Bearer {{adminToken}}

###############################################################################
# 6. RESOLVE FLAGS
###############################################################################

### Resolve flag - false positive
POST {{baseUrl}}/api/v1/merchants/{{merchantId}}/flags/{{flagId}}/resolve
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "resolution": "False positive. Transactions verified as legitimate business activity. Documentation reviewed and approved."
}

### Resolve flag - issue corrected
POST {{baseUrl}}/api/v1/merchants/{{merchantId}}/flags/{{flagId}}/resolve
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "resolution": "Issue corrected. Merchant provided required documentation and implemented additional compliance measures. Monitoring continues."
}

### Resolve flag - no action needed
POST {{baseUrl}}/api/v1/merchants/{{merchantId}}/flags/{{flagId}}/resolve
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "resolution": "Reviewed and determined no action needed. Activity within acceptable parameters. Flag resolved."
}

###############################################################################
# 7. ERROR CASES (for testing validation)
###############################################################################

### Suspend with note too short (should fail)
POST {{baseUrl}}/api/v1/merchants/{{merchantId}}/suspend
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "reason": "MANUAL",
  "note": "Too short",
  "durationHours": 24
}

### Terminate with note too short (should fail)
POST {{baseUrl}}/api/v1/merchants/{{merchantId}}/terminate
Authorization: Bearer {{superAdminToken}}
Content-Type: application/json

{
  "reason": "FRAUD_CONFIRMED",
  "note": "This note is too short for termination",
  "confirmed": true
}

### Terminate without super admin token (should fail with 403)
POST {{baseUrl}}/api/v1/merchants/{{merchantId}}/terminate
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "reason": "FRAUD_CONFIRMED",
  "note": "This should fail because user is not SUPER_ADMIN. Testing permission enforcement.",
  "confirmed": true
}

### Add flag with description too short (should fail)
POST {{baseUrl}}/api/v1/merchants/{{merchantId}}/flags
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "type": "AML_ALERT",
  "severity": "HIGH",
  "description": "Too short"
}

###############################################################################
# 8. WORKFLOW EXAMPLES
###############################################################################

### Complete suspension workflow
# 1. Suspend merchant
POST {{baseUrl}}/api/v1/merchants/{{merchantId}}/suspend
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "reason": "FRAUD_INVESTIGATION",
  "note": "Suspicious activity detected. Account suspended for investigation.",
  "durationHours": 48
}

# 2. Add flag during investigation
POST {{baseUrl}}/api/v1/merchants/{{merchantId}}/flags
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "type": "FRAUD_SUSPECTED",
  "severity": "HIGH",
  "description": "Under investigation for potential fraudulent transactions. Multiple red flags identified."
}

# 3. Review flags
GET {{baseUrl}}/api/v1/merchants/{{merchantId}}/flags
Authorization: Bearer {{adminToken}}

# 4. Resolve flag after investigation
POST {{baseUrl}}/api/v1/merchants/{{merchantId}}/flags/{{flagId}}/resolve
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "resolution": "Investigation completed. Activity verified as legitimate. No fraud detected."
}

# 5. Unsuspend merchant
POST {{baseUrl}}/api/v1/merchants/{{merchantId}}/unsuspend
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "note": "Investigation completed successfully. No violations found. Account reactivated."
}

###############################################################################
# NOTES
###############################################################################

# Validation Rules:
# - Suspension note: 20-2000 characters
# - Unsuspension note: 10-2000 characters
# - Termination note: 50-5000 characters (longer required)
# - Flag description: 20-2000 characters
# - Flag resolution: 10-2000 characters
# - Duration hours: 1-8760 (optional for suspension)

# Permissions:
# - merchants:write: ADMIN, SUPER_ADMIN (suspend/unsuspend)
# - merchants:terminate: SUPER_ADMIN only (terminate)
# - risk:manage: ADMIN, SUPER_ADMIN, SUPPORT_ADMIN (flags)

# Status Transitions:
# - ACTIVE -> SUSPENDED (via suspend)
# - SUSPENDED -> ACTIVE (via unsuspend or auto-unsuspend)
# - ANY -> TERMINATED (via terminate, irreversible)

# Auto-Unsuspend:
# - Fires within 1 minute of scheduled time
# - Can be cancelled by manual unsuspend
# - Creates system audit log entry
